{"format_version":"1.2","terraform_version":"1.13.0","variables":{"alert_email":{"value":"binodbhatta@gmail.com"},"container_image":{"value":"bbhbdb/qapi"},"container_port":{"value":8000},"container_tag":{"value":"secure"},"instance_count":{"value":2},"kv_purge_protect":{"value":false},"kv_sku":{"value":"standard"},"location":{"value":"australiasoutheast"},"operator_ip":{"value":"4.200.132.152"},"pg_backup_days":{"value":7},"pg_db_name":{"value":"quotes-poc"},"pg_sku_name":{"value":"B_Standard_B1ms"},"pg_storage_mb":{"value":32768},"project":{"value":"quoteapi-poc"}},"planned_values":{"root_module":{}},"resource_changes":[{"address":"module.compute.azurerm_container_app.app","module_address":"module.compute","mode":"managed","type":"azurerm_container_app","name":"app","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"container_app_environment_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","custom_domain_verification_id":"C5361B23941B720179464255D02CE10C575019272866ED6DE41FED8A5F5E3236","dapr":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi","identity":[{"identity_ids":[],"principal_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","type":"SystemAssigned"}],"ingress":[{"allow_insecure_connections":false,"client_certificate_mode":"ignore","cors":[],"custom_domain":[],"exposed_port":0,"external_enabled":true,"fqdn":"quoteapi-poc-quoteapi.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","ip_security_restriction":[],"target_port":8000,"traffic_weight":[{"label":"","latest_revision":true,"percentage":100,"revision_suffix":""}],"transport":"auto"}],"latest_revision_fqdn":"quoteapi-poc-quoteapi--el6xgr5.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","latest_revision_name":"quoteapi-poc-quoteapi--el6xgr5","location":"australiasoutheast","max_inactive_revisions":0,"name":"quoteapi-poc-quoteapi","outbound_ip_addresses":["4.198.149.72"],"registry":[],"resource_group_name":"quoteapi-poc-rg","revision_mode":"Single","secret":[{"identity":"","key_vault_secret_id":"","name":"db-conn-str","value":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr/8b68700a8092452a82a168d827559577"}],"tags":{"project":"quoteapi-poc"},"template":[{"azure_queue_scale_rule":[],"container":[{"args":[],"command":[],"cpu":0.5,"env":[{"name":"DB_CONNECTION_STRING","secret_name":"","value":"secretref:db-conn-str"}],"ephemeral_storage":"2Gi","image":"bbhbdb/qapi:secure","liveness_probe":[],"memory":"1Gi","name":"quoteapi","readiness_probe":[],"startup_probe":[],"volume_mounts":[]}],"custom_scale_rule":[],"http_scale_rule":[],"init_container":[],"max_replicas":2,"min_replicas":2,"revision_suffix":"","tcp_scale_rule":[],"termination_grace_period_seconds":0,"volume":[]}],"timeouts":null,"workload_profile_name":""},"after":null,"after_unknown":{},"before_sensitive":{"custom_domain_verification_id":true,"dapr":[],"identity":[{"identity_ids":[]}],"ingress":[{"cors":[],"custom_domain":[],"ip_security_restriction":[],"traffic_weight":[{}]}],"outbound_ip_addresses":[false],"registry":[],"secret":true,"tags":{},"template":[{"azure_queue_scale_rule":[],"container":[{"args":[],"command":[],"env":[{}],"liveness_probe":[],"readiness_probe":[],"startup_probe":[],"volume_mounts":[]}],"custom_scale_rule":[],"http_scale_rule":[],"init_container":[],"tcp_scale_rule":[],"volume":[]}]},"after_sensitive":false}},{"address":"module.compute.azurerm_container_app_environment.env","module_address":"module.compute","mode":"managed","type":"azurerm_container_app_environment","name":"env","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"custom_domain_verification_id":"C5361B23941B720179464255D02CE10C575019272866ED6DE41FED8A5F5E3236","dapr_application_insights_connection_string":"","default_domain":"salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","docker_bridge_cidr":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","identity":[],"infrastructure_resource_group_name":"","infrastructure_subnet_id":"","internal_load_balancer_enabled":false,"location":"australiasoutheast","log_analytics_workspace_id":"","logs_destination":"","mutual_tls_enabled":false,"name":"quoteapi-poc-ca-env","platform_reserved_cidr":"","platform_reserved_dns_ip_address":"","resource_group_name":"quoteapi-poc-rg","static_ip_address":"4.198.129.111","tags":{"project":"quoteapi-poc"},"timeouts":null,"workload_profile":[],"zone_redundancy_enabled":false},"after":null,"after_unknown":{},"before_sensitive":{"dapr_application_insights_connection_string":true,"identity":[],"tags":{},"workload_profile":[]},"after_sensitive":false}},{"address":"module.compute.azurerm_key_vault_access_policy.app","module_address":"module.compute","mode":"managed","type":"azurerm_key_vault_access_policy","name":"app","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"application_id":"","certificate_permissions":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/objectId/859d0f79-d0ed-4beb-bb92-14ac74f71831","key_permissions":[],"key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","object_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","secret_permissions":["Get","List"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false],"storage_permissions":[]},"after_sensitive":false}},{"address":"module.compute.azurerm_monitor_diagnostic_setting.app_diag","module_address":"module.compute","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"app_diag","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"enabled_log":[],"enabled_metric":[{"category":"AllMetrics"}],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi|quoteapi-poc-app-diag","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":true,"retention_policy":[{"days":0,"enabled":false}]}],"name":"quoteapi-poc-app-diag","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"enabled_log":[],"enabled_metric":[{}],"metric":[{"retention_policy":[{}]}]},"after_sensitive":false}},{"address":"module.compute.azurerm_monitor_diagnostic_setting.env_logs","module_address":"module.compute","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"env_logs","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"enabled_log":[{"category":"ContainerAppConsoleLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]},{"category":"ContainerAppSystemLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]}],"enabled_metric":[],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env|quoteapi-poc-env-logs","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":false,"retention_policy":[{"days":0,"enabled":false}]}],"name":"quoteapi-poc-env-logs","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"enabled_log":[{"retention_policy":[{}]},{"retention_policy":[{}]}],"enabled_metric":[],"metric":[{"retention_policy":[{}]}]},"after_sensitive":false}},{"address":"module.compute.azurerm_monitor_metric_alert.http5xx_count","module_address":"module.compute","mode":"managed","type":"azurerm_monitor_metric_alert","name":"http5xx_count","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"action":[{"action_group_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/actionGroups/quoteapi-poc-ag","webhook_properties":{}}],"application_insights_web_test_location_availability_criteria":[],"auto_mitigate":true,"criteria":[{"aggregation":"Total","dimension":[{"name":"statusCodeCategory","operator":"Include","values":["5xx"]}],"metric_name":"Requests","metric_namespace":"Microsoft.App/containerApps","operator":"GreaterThan","skip_metric_validation":false,"threshold":10}],"description":"5xx requests in the last 5m exceed threshold","dynamic_criteria":[],"enabled":true,"frequency":"PT1M","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/metricAlerts/quoteapi-poc-5xx-count","name":"quoteapi-poc-5xx-count","resource_group_name":"quoteapi-poc-rg","scopes":["/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi"],"severity":3,"tags":{},"target_resource_location":"","target_resource_type":"","timeouts":null,"window_size":"PT5M"},"after":null,"after_unknown":{},"before_sensitive":{"action":[{"webhook_properties":{}}],"application_insights_web_test_location_availability_criteria":[],"criteria":[{"dimension":[{"values":[false]}]}],"dynamic_criteria":[],"scopes":[false],"tags":{}},"after_sensitive":false}},{"address":"module.data.azurerm_monitor_diagnostic_setting.pg_diag","module_address":"module.data","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"pg_diag","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"enabled_log":[{"category":"PostgreSQLLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]}],"enabled_metric":[{"category":"AllMetrics"}],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc|PostgreSQLDiagnostics","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":true,"retention_policy":[{"days":0,"enabled":false}]}],"name":"PostgreSQLDiagnostics","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"enabled_log":[{"retention_policy":[{}]}],"enabled_metric":[{}],"metric":[{"retention_policy":[{}]}]},"after_sensitive":false}},{"address":"module.data.azurerm_postgresql_flexible_server.pg","module_address":"module.data","mode":"managed","type":"azurerm_postgresql_flexible_server","name":"pg","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"administrator_login":"pgadmin","administrator_password":"[5jthh1?4[i9ifrB\u003c%%S","administrator_password_wo":null,"administrator_password_wo_version":0,"authentication":[{"active_directory_auth_enabled":false,"password_auth_enabled":true,"tenant_id":""}],"auto_grow_enabled":false,"backup_retention_days":7,"create_mode":null,"customer_managed_key":[],"delegated_subnet_id":"","fqdn":"quotes-poc.postgres.database.azure.com","geo_redundant_backup_enabled":false,"high_availability":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","identity":[],"location":"australiasoutheast","maintenance_window":[],"name":"quotes-poc","point_in_time_restore_time_in_utc":null,"private_dns_zone_id":"","public_network_access_enabled":true,"replication_role":"","resource_group_name":"quoteapi-poc-rg","sku_name":"B_Standard_B1ms","source_server_id":"","storage_mb":32768,"storage_tier":"P4","tags":{"project":"quoteapi-poc"},"timeouts":null,"version":"16","zone":""},"after":null,"after_unknown":{},"before_sensitive":{"administrator_password":true,"authentication":[{}],"customer_managed_key":[],"high_availability":[],"identity":[],"maintenance_window":[],"tags":{}},"after_sensitive":false}},{"address":"module.data.azurerm_postgresql_flexible_server_database.db","module_address":"module.data","mode":"managed","type":"azurerm_postgresql_flexible_server_database","name":"db","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"charset":"UTF8","collation":"en_US.utf8","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc/databases/quotes-poc","name":"quotes-poc","server_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{},"after_sensitive":false}},{"address":"module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module_address":"module.data","mode":"managed","type":"azurerm_postgresql_flexible_server_firewall_rule","name":"allowed_ip","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"end_ip_address":"4.200.132.152","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc/firewallRules/operator-ip","name":"operator-ip","server_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","start_ip_address":"4.200.132.152","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{},"after_sensitive":false,"before_identity":{"flexible_server_name":"quotes-poc","name":"operator-ip","resource_group_name":"quoteapi-poc-rg","subscription_id":"fa127f23-4720-4538-b725-9219e558d71b"}}},{"address":"module.data.random_password.pg","module_address":"module.data","mode":"managed","type":"random_password","name":"pg","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["delete"],"before":{"bcrypt_hash":"$2a$10$I730qNaHTBjdPF1uIONTtOF4XgRjd9ehKqbuB.ZRmIU2zi1/0QGUa","id":"none","keepers":null,"length":20,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"numeric":true,"override_special":null,"result":"[5jthh1?4[i9ifrB\u003c%%S","special":true,"upper":true},"after":null,"after_unknown":{},"before_sensitive":{"bcrypt_hash":true,"result":true},"after_sensitive":false}},{"address":"module.keyvault.azurerm_key_vault.kv","module_address":"module.keyvault","mode":"managed","type":"azurerm_key_vault","name":"kv","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"access_policy":[{"application_id":"","certificate_permissions":[],"key_permissions":[],"object_id":"34234ff9-2232-4b19-8c80-c4f55bb2d8df","secret_permissions":["Get","List","Set","Delete"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db"},{"application_id":"","certificate_permissions":[],"key_permissions":[],"object_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","secret_permissions":["Get","List"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db"}],"contact":[],"enable_rbac_authorization":false,"enabled_for_deployment":false,"enabled_for_disk_encryption":false,"enabled_for_template_deployment":false,"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","location":"australiasoutheast","name":"quoteapi-poc-kv-t0pw","network_acls":[{"bypass":"AzureServices","default_action":"Deny","ip_rules":["4.200.132.152/32"],"virtual_network_subnet_ids":[]}],"public_network_access_enabled":true,"purge_protection_enabled":false,"rbac_authorization_enabled":false,"resource_group_name":"quoteapi-poc-rg","sku_name":"standard","soft_delete_retention_days":7,"tags":{"project":"quoteapi-poc"},"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null,"vault_uri":"https://quoteapi-poc-kv-t0pw.vault.azure.net/"},"after":null,"after_unknown":{},"before_sensitive":{"access_policy":[{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false,false,false],"storage_permissions":[]},{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false],"storage_permissions":[]}],"contact":[],"network_acls":[{"ip_rules":[false],"virtual_network_subnet_ids":[]}],"tags":{}},"after_sensitive":false}},{"address":"module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module_address":"module.keyvault","mode":"managed","type":"azurerm_key_vault_access_policy","name":"terraform_operator","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"application_id":"","certificate_permissions":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/objectId/34234ff9-2232-4b19-8c80-c4f55bb2d8df","key_permissions":[],"key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","object_id":"34234ff9-2232-4b19-8c80-c4f55bb2d8df","secret_permissions":["Get","List","Set","Delete"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false,false,false],"storage_permissions":[]},"after_sensitive":false}},{"address":"module.keyvault.azurerm_key_vault_secret.db","module_address":"module.keyvault","mode":"managed","type":"azurerm_key_vault_secret","name":"db","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"content_type":"text/plain","expiration_date":"2026-09-02T00:17:57Z","id":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr/8b68700a8092452a82a168d827559577","key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","name":"db-connstr","not_before_date":null,"resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/secrets/db-connstr/versions/8b68700a8092452a82a168d827559577","resource_versionless_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/secrets/db-connstr","tags":{},"timeouts":null,"value":"postgresql://pgadmin:%5B5jthh1%3F4%5Bi9ifrB%3C%25%25S@quotes-poc.postgres.database.azure.com:5432/quotes-poc?sslmode=require","value_wo":null,"value_wo_version":0,"version":"8b68700a8092452a82a168d827559577","versionless_id":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr"},"after":null,"after_unknown":{},"before_sensitive":{"tags":{},"value":true},"after_sensitive":false}},{"address":"module.keyvault.random_string.kv_suffix","module_address":"module.keyvault","mode":"managed","type":"random_string","name":"kv_suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["delete"],"before":{"id":"t0pw","keepers":null,"length":4,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"numeric":true,"override_special":null,"result":"t0pw","special":false,"upper":false},"after":null,"after_unknown":{},"before_sensitive":{},"after_sensitive":false}},{"address":"module.monitoring.azurerm_log_analytics_workspace.law","module_address":"module.monitoring","mode":"managed","type":"azurerm_log_analytics_workspace","name":"law","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"allow_resource_only_permissions":true,"cmk_for_query_forced":false,"daily_quota_gb":-1,"data_collection_rule_id":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","identity":[],"immediate_data_purge_on_30_days_enabled":false,"internet_ingestion_enabled":true,"internet_query_enabled":true,"local_authentication_disabled":true,"local_authentication_enabled":false,"location":"australiasoutheast","name":"quoteapi-poc-law","primary_shared_key":"k+5PC8ugv3yImaj9jB27cRAzaxHbslNCeEyj/kJxlqRuXPXkVVnqOZFLD6lQCD+QyO/xl0+KRTzvshbGenBNXA==","reservation_capacity_in_gb_per_day":null,"resource_group_name":"quoteapi-poc-rg","retention_in_days":30,"secondary_shared_key":"CkGk5ZmjIT+wV8+BngQi2/9++Q5IARKofu22KMD1IMcOKsOiJPHztPW3M2jAX7UgqmDNelCOtZ3fVFan5yQ2CA==","sku":"PerGB2018","tags":{"project":"quoteapi-poc"},"timeouts":null,"workspace_id":"764240cb-e6bb-4fb1-a5fd-ef3aac4af662"},"after":null,"after_unknown":{},"before_sensitive":{"identity":[],"primary_shared_key":true,"secondary_shared_key":true,"tags":{}},"after_sensitive":false}},{"address":"module.monitoring.azurerm_monitor_action_group.ag","module_address":"module.monitoring","mode":"managed","type":"azurerm_monitor_action_group","name":"ag","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"arm_role_receiver":[],"automation_runbook_receiver":[],"azure_app_push_receiver":[],"azure_function_receiver":[],"email_receiver":[{"email_address":"binodbhatta@gmail.com","name":"primary","use_common_alert_schema":false}],"enabled":true,"event_hub_receiver":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/actionGroups/quoteapi-poc-ag","itsm_receiver":[],"location":"global","logic_app_receiver":[],"name":"quoteapi-poc-ag","resource_group_name":"quoteapi-poc-rg","short_name":"quoteapi-poc","sms_receiver":[],"tags":{},"timeouts":null,"voice_receiver":[],"webhook_receiver":[]},"after":null,"after_unknown":{},"before_sensitive":{"arm_role_receiver":[],"automation_runbook_receiver":[],"azure_app_push_receiver":[],"azure_function_receiver":[],"email_receiver":[{}],"event_hub_receiver":[],"itsm_receiver":[],"logic_app_receiver":[],"sms_receiver":[],"tags":{},"voice_receiver":[],"webhook_receiver":[]},"after_sensitive":false,"before_identity":{"name":"quoteapi-poc-ag","resource_group_name":"quoteapi-poc-rg","subscription_id":"fa127f23-4720-4538-b725-9219e558d71b"}}},{"address":"module.network.azurerm_resource_group.rg","module_address":"module.network","mode":"managed","type":"azurerm_resource_group","name":"rg","provider_name":"registry.terraform.io/hashicorp/azurerm","change":{"actions":["delete"],"before":{"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg","location":"australiasoutheast","managed_by":"","name":"quoteapi-poc-rg","tags":{"env":"quoteapi-poc"},"timeouts":null},"after":null,"after_unknown":{},"before_sensitive":{"tags":{}},"after_sensitive":false}}],"output_changes":{"db_host":{"actions":["delete"],"before":"quotes-poc.postgres.database.azure.com","after":null,"after_unknown":false,"before_sensitive":false,"after_sensitive":false},"db_name":{"actions":["delete"],"before":"quotes-poc","after":null,"after_unknown":false,"before_sensitive":false,"after_sensitive":false},"db_pass":{"actions":["delete"],"before":"%5B5jthh1%3F4%5Bi9ifrB%3C%25%25S","after":null,"after_unknown":false,"before_sensitive":true,"after_sensitive":true},"db_user":{"actions":["delete"],"before":"pgadmin","after":null,"after_unknown":false,"before_sensitive":true,"after_sensitive":true},"quote_url":{"actions":["delete"],"before":"https://quoteapi-poc-quoteapi--el6xgr5.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","after":null,"after_unknown":false,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.13.0","values":{"outputs":{"db_host":{"sensitive":false,"value":"quotes-poc.postgres.database.azure.com","type":"string"},"db_name":{"sensitive":false,"value":"quotes-poc","type":"string"},"db_pass":{"sensitive":true,"value":"%5B5jthh1%3F4%5Bi9ifrB%3C%25%25S","type":"string"},"db_user":{"sensitive":true,"value":"pgadmin","type":"string"},"quote_url":{"sensitive":false,"value":"https://quoteapi-poc-quoteapi--el6xgr5.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","type":"string"}},"root_module":{"child_modules":[{"resources":[{"address":"module.compute.azurerm_container_app.app","mode":"managed","type":"azurerm_container_app","name":"app","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"container_app_environment_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","custom_domain_verification_id":"C5361B23941B720179464255D02CE10C575019272866ED6DE41FED8A5F5E3236","dapr":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi","identity":[{"identity_ids":[],"principal_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","type":"SystemAssigned"}],"ingress":[{"allow_insecure_connections":false,"client_certificate_mode":"ignore","cors":[],"custom_domain":[],"exposed_port":0,"external_enabled":true,"fqdn":"quoteapi-poc-quoteapi.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","ip_security_restriction":[],"target_port":8000,"traffic_weight":[{"label":"","latest_revision":true,"percentage":100,"revision_suffix":""}],"transport":"auto"}],"latest_revision_fqdn":"quoteapi-poc-quoteapi--el6xgr5.salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","latest_revision_name":"quoteapi-poc-quoteapi--el6xgr5","location":"australiasoutheast","max_inactive_revisions":0,"name":"quoteapi-poc-quoteapi","outbound_ip_addresses":["4.198.149.72"],"registry":[],"resource_group_name":"quoteapi-poc-rg","revision_mode":"Single","secret":[{"identity":"","key_vault_secret_id":"","name":"db-conn-str","value":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr/8b68700a8092452a82a168d827559577"}],"tags":{"project":"quoteapi-poc"},"template":[{"azure_queue_scale_rule":[],"container":[{"args":[],"command":[],"cpu":0.5,"env":[{"name":"DB_CONNECTION_STRING","secret_name":"","value":"secretref:db-conn-str"}],"ephemeral_storage":"2Gi","image":"bbhbdb/qapi:secure","liveness_probe":[],"memory":"1Gi","name":"quoteapi","readiness_probe":[],"startup_probe":[],"volume_mounts":[]}],"custom_scale_rule":[],"http_scale_rule":[],"init_container":[],"max_replicas":2,"min_replicas":2,"revision_suffix":"","tcp_scale_rule":[],"termination_grace_period_seconds":0,"volume":[]}],"timeouts":null,"workload_profile_name":""},"sensitive_values":{"custom_domain_verification_id":true,"dapr":[],"identity":[{"identity_ids":[]}],"ingress":[{"cors":[],"custom_domain":[],"ip_security_restriction":[],"traffic_weight":[{}]}],"outbound_ip_addresses":[false],"registry":[],"secret":true,"tags":{},"template":[{"azure_queue_scale_rule":[],"container":[{"args":[],"command":[],"env":[{}],"liveness_probe":[],"readiness_probe":[],"startup_probe":[],"volume_mounts":[]}],"custom_scale_rule":[],"http_scale_rule":[],"init_container":[],"tcp_scale_rule":[],"volume":[]}]},"depends_on":["module.compute.azurerm_container_app_environment.env","module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.compute.azurerm_container_app_environment.env","mode":"managed","type":"azurerm_container_app_environment","name":"env","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"custom_domain_verification_id":"C5361B23941B720179464255D02CE10C575019272866ED6DE41FED8A5F5E3236","dapr_application_insights_connection_string":"","default_domain":"salmonpond-d8fda086.australiasoutheast.azurecontainerapps.io","docker_bridge_cidr":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","identity":[],"infrastructure_resource_group_name":"","infrastructure_subnet_id":"","internal_load_balancer_enabled":false,"location":"australiasoutheast","log_analytics_workspace_id":"","logs_destination":"","mutual_tls_enabled":false,"name":"quoteapi-poc-ca-env","platform_reserved_cidr":"","platform_reserved_dns_ip_address":"","resource_group_name":"quoteapi-poc-rg","static_ip_address":"4.198.129.111","tags":{"project":"quoteapi-poc"},"timeouts":null,"workload_profile":[],"zone_redundancy_enabled":false},"sensitive_values":{"dapr_application_insights_connection_string":true,"identity":[],"tags":{},"workload_profile":[]},"depends_on":["module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.compute.azurerm_key_vault_access_policy.app","mode":"managed","type":"azurerm_key_vault_access_policy","name":"app","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"application_id":"","certificate_permissions":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/objectId/859d0f79-d0ed-4beb-bb92-14ac74f71831","key_permissions":[],"key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","object_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","secret_permissions":["Get","List"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null},"sensitive_values":{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false],"storage_permissions":[]},"depends_on":["module.compute.azurerm_container_app.app","module.compute.azurerm_container_app_environment.env","module.compute.data.azurerm_client_config.current","module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.compute.azurerm_monitor_diagnostic_setting.app_diag","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"app_diag","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"enabled_log":[],"enabled_metric":[{"category":"AllMetrics"}],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi|quoteapi-poc-app-diag","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":true,"retention_policy":[{"days":0,"enabled":false}]}],"name":"quoteapi-poc-app-diag","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi","timeouts":null},"sensitive_values":{"enabled_log":[],"enabled_metric":[{}],"metric":[{"retention_policy":[{}]}]},"depends_on":["module.compute.azurerm_container_app.app","module.compute.azurerm_container_app_environment.env","module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.compute.azurerm_monitor_diagnostic_setting.env_logs","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"env_logs","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"enabled_log":[{"category":"ContainerAppConsoleLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]},{"category":"ContainerAppSystemLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]}],"enabled_metric":[],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env|quoteapi-poc-env-logs","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":false,"retention_policy":[{"days":0,"enabled":false}]}],"name":"quoteapi-poc-env-logs","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/managedEnvironments/quoteapi-poc-ca-env","timeouts":null},"sensitive_values":{"enabled_log":[{"retention_policy":[{}]},{"retention_policy":[{}]}],"enabled_metric":[],"metric":[{"retention_policy":[{}]}]},"depends_on":["module.compute.azurerm_container_app_environment.env","module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.compute.azurerm_monitor_metric_alert.http5xx_count","mode":"managed","type":"azurerm_monitor_metric_alert","name":"http5xx_count","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":1,"values":{"action":[{"action_group_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/actionGroups/quoteapi-poc-ag","webhook_properties":{}}],"application_insights_web_test_location_availability_criteria":[],"auto_mitigate":true,"criteria":[{"aggregation":"Total","dimension":[{"name":"statusCodeCategory","operator":"Include","values":["5xx"]}],"metric_name":"Requests","metric_namespace":"Microsoft.App/containerApps","operator":"GreaterThan","skip_metric_validation":false,"threshold":10}],"description":"5xx requests in the last 5m exceed threshold","dynamic_criteria":[],"enabled":true,"frequency":"PT1M","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/metricAlerts/quoteapi-poc-5xx-count","name":"quoteapi-poc-5xx-count","resource_group_name":"quoteapi-poc-rg","scopes":["/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.App/containerApps/quoteapi-poc-quoteapi"],"severity":3,"tags":{},"target_resource_location":"","target_resource_type":"","timeouts":null,"window_size":"PT5M"},"sensitive_values":{"action":[{"webhook_properties":{}}],"application_insights_web_test_location_availability_criteria":[],"criteria":[{"dimension":[{"values":[false]}]}],"dynamic_criteria":[],"scopes":[false],"tags":{}},"depends_on":["module.compute.azurerm_container_app.app","module.compute.azurerm_container_app_environment.env","module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.azurerm_key_vault_secret.db","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]}],"address":"module.compute"},{"resources":[{"address":"module.data.azurerm_monitor_diagnostic_setting.pg_diag","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"pg_diag","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"enabled_log":[{"category":"PostgreSQLLogs","category_group":"","retention_policy":[{"days":0,"enabled":false}]}],"enabled_metric":[{"category":"AllMetrics"}],"eventhub_authorization_rule_id":"","eventhub_name":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc|PostgreSQLDiagnostics","log_analytics_destination_type":"","log_analytics_workspace_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","metric":[{"category":"AllMetrics","enabled":true,"retention_policy":[{"days":0,"enabled":false}]}],"name":"PostgreSQLDiagnostics","partner_solution_id":null,"storage_account_id":null,"target_resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","timeouts":null},"sensitive_values":{"enabled_log":[{"retention_policy":[{}]}],"enabled_metric":[{}],"metric":[{"retention_policy":[{}]}]},"depends_on":["module.data.azurerm_postgresql_flexible_server.pg","module.data.random_password.pg","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.data.azurerm_postgresql_flexible_server.pg","mode":"managed","type":"azurerm_postgresql_flexible_server","name":"pg","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"administrator_login":"pgadmin","administrator_password":"[5jthh1?4[i9ifrB\u003c%%S","administrator_password_wo":null,"administrator_password_wo_version":0,"authentication":[{"active_directory_auth_enabled":false,"password_auth_enabled":true,"tenant_id":""}],"auto_grow_enabled":false,"backup_retention_days":7,"create_mode":null,"customer_managed_key":[],"delegated_subnet_id":"","fqdn":"quotes-poc.postgres.database.azure.com","geo_redundant_backup_enabled":false,"high_availability":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","identity":[],"location":"australiasoutheast","maintenance_window":[],"name":"quotes-poc","point_in_time_restore_time_in_utc":null,"private_dns_zone_id":"","public_network_access_enabled":true,"replication_role":"","resource_group_name":"quoteapi-poc-rg","sku_name":"B_Standard_B1ms","source_server_id":"","storage_mb":32768,"storage_tier":"P4","tags":{"project":"quoteapi-poc"},"timeouts":null,"version":"16","zone":""},"sensitive_values":{"administrator_password":true,"authentication":[{}],"customer_managed_key":[],"high_availability":[],"identity":[],"maintenance_window":[],"tags":{}},"depends_on":["module.data.random_password.pg","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.data.azurerm_postgresql_flexible_server_database.db","mode":"managed","type":"azurerm_postgresql_flexible_server_database","name":"db","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"charset":"UTF8","collation":"en_US.utf8","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc/databases/quotes-poc","name":"quotes-poc","server_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","timeouts":null},"sensitive_values":{},"depends_on":["module.data.azurerm_postgresql_flexible_server.pg","module.data.random_password.pg","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","mode":"managed","type":"azurerm_postgresql_flexible_server_firewall_rule","name":"allowed_ip","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"end_ip_address":"4.200.132.152","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc/firewallRules/operator-ip","name":"operator-ip","server_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/quotes-poc","start_ip_address":"4.200.132.152","timeouts":null},"sensitive_values":{},"depends_on":["module.data.azurerm_postgresql_flexible_server.pg","module.data.random_password.pg","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"],"identity_schema_version":0,"identity":{"flexible_server_name":"quotes-poc","name":"operator-ip","resource_group_name":"quoteapi-poc-rg","subscription_id":"fa127f23-4720-4538-b725-9219e558d71b"}},{"address":"module.data.random_password.pg","mode":"managed","type":"random_password","name":"pg","provider_name":"registry.terraform.io/hashicorp/random","schema_version":3,"values":{"bcrypt_hash":"$2a$10$I730qNaHTBjdPF1uIONTtOF4XgRjd9ehKqbuB.ZRmIU2zi1/0QGUa","id":"none","keepers":null,"length":20,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"numeric":true,"override_special":null,"result":"[5jthh1?4[i9ifrB\u003c%%S","special":true,"upper":true},"sensitive_values":{"bcrypt_hash":true,"result":true},"depends_on":["module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]}],"address":"module.data"},{"resources":[{"address":"module.keyvault.data.azurerm_client_config.current","mode":"data","type":"azurerm_client_config","name":"current","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"client_id":"04b07795-8ddb-461a-bbee-02f9e1bf7b46","id":"Y2xpZW50Q29uZmlncy9jbGllbnRJZD0wNGIwNzc5NS04ZGRiLTQ2MWEtYmJlZS0wMmY5ZTFiZjdiNDY7b2JqZWN0SWQ9MzQyMzRmZjktMjIzMi00YjE5LThjODAtYzRmNTViYjJkOGRmO3N1YnNjcmlwdGlvbklkPWZhMTI3ZjIzLTQ3MjAtNDUzOC1iNzI1LTkyMTllNTU4ZDcxYjt0ZW5hbnRJZD1mYjI1MTNjMy1jYzdlLTQyMzgtOWY5OS02YzkzNmY2MmUyZGI=","object_id":"34234ff9-2232-4b19-8c80-c4f55bb2d8df","subscription_id":"fa127f23-4720-4538-b725-9219e558d71b","tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null},"sensitive_values":{}},{"address":"module.keyvault.azurerm_key_vault.kv","mode":"managed","type":"azurerm_key_vault","name":"kv","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":2,"values":{"access_policy":[{"application_id":"","certificate_permissions":[],"key_permissions":[],"object_id":"34234ff9-2232-4b19-8c80-c4f55bb2d8df","secret_permissions":["Get","List","Set","Delete"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db"},{"application_id":"","certificate_permissions":[],"key_permissions":[],"object_id":"859d0f79-d0ed-4beb-bb92-14ac74f71831","secret_permissions":["Get","List"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db"}],"contact":[],"enable_rbac_authorization":false,"enabled_for_deployment":false,"enabled_for_disk_encryption":false,"enabled_for_template_deployment":false,"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","location":"australiasoutheast","name":"quoteapi-poc-kv-t0pw","network_acls":[{"bypass":"AzureServices","default_action":"Deny","ip_rules":["4.200.132.152/32"],"virtual_network_subnet_ids":[]}],"public_network_access_enabled":true,"purge_protection_enabled":false,"rbac_authorization_enabled":false,"resource_group_name":"quoteapi-poc-rg","sku_name":"standard","soft_delete_retention_days":7,"tags":{"project":"quoteapi-poc"},"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null,"vault_uri":"https://quoteapi-poc-kv-t0pw.vault.azure.net/"},"sensitive_values":{"access_policy":[{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false,false,false],"storage_permissions":[]},{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false],"storage_permissions":[]}],"contact":[],"network_acls":[{"ip_rules":[false],"virtual_network_subnet_ids":[]}],"tags":{}},"depends_on":["module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.keyvault.azurerm_key_vault_access_policy.terraform_operator","mode":"managed","type":"azurerm_key_vault_access_policy","name":"terraform_operator","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"application_id":"","certificate_permissions":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/objectId/34234ff9-2232-4b19-8c80-c4f55bb2d8df","key_permissions":[],"key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","object_id":"34234ff9-2232-4b19-8c80-c4f55bb2d8df","secret_permissions":["Get","List","Set","Delete"],"storage_permissions":[],"tenant_id":"fb2513c3-cc7e-4238-9f99-6c936f62e2db","timeouts":null},"sensitive_values":{"certificate_permissions":[],"key_permissions":[],"secret_permissions":[false,false,false,false],"storage_permissions":[]},"depends_on":["module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.keyvault.azurerm_key_vault_secret.db","mode":"managed","type":"azurerm_key_vault_secret","name":"db","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"content_type":"text/plain","expiration_date":"2026-09-02T00:17:57Z","id":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr/8b68700a8092452a82a168d827559577","key_vault_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw","name":"db-connstr","not_before_date":null,"resource_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/secrets/db-connstr/versions/8b68700a8092452a82a168d827559577","resource_versionless_id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.KeyVault/vaults/quoteapi-poc-kv-t0pw/secrets/db-connstr","tags":{},"timeouts":null,"value":"postgresql://pgadmin:%5B5jthh1%3F4%5Bi9ifrB%3C%25%25S@quotes-poc.postgres.database.azure.com:5432/quotes-poc?sslmode=require","value_wo":null,"value_wo_version":0,"version":"8b68700a8092452a82a168d827559577","versionless_id":"https://quoteapi-poc-kv-t0pw.vault.azure.net/secrets/db-connstr"},"sensitive_values":{"tags":{},"value":true},"depends_on":["module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.keyvault.azurerm_key_vault.kv","module.keyvault.azurerm_key_vault_access_policy.terraform_operator","module.keyvault.data.azurerm_client_config.current","module.keyvault.random_string.kv_suffix","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]},{"address":"module.keyvault.random_string.kv_suffix","mode":"managed","type":"random_string","name":"kv_suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":2,"values":{"id":"t0pw","keepers":null,"length":4,"lower":true,"min_lower":0,"min_numeric":0,"min_special":0,"min_upper":0,"number":true,"numeric":true,"override_special":null,"result":"t0pw","special":false,"upper":false},"sensitive_values":{},"depends_on":["module.data.azurerm_monitor_diagnostic_setting.pg_diag","module.data.azurerm_postgresql_flexible_server.pg","module.data.azurerm_postgresql_flexible_server_database.db","module.data.azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","module.data.random_password.pg","module.monitoring.azurerm_log_analytics_workspace.law","module.monitoring.azurerm_monitor_action_group.ag","module.network.azurerm_resource_group.rg"]}],"address":"module.keyvault"},{"resources":[{"address":"module.monitoring.azurerm_log_analytics_workspace.law","mode":"managed","type":"azurerm_log_analytics_workspace","name":"law","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":3,"values":{"allow_resource_only_permissions":true,"cmk_for_query_forced":false,"daily_quota_gb":-1,"data_collection_rule_id":"","id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.OperationalInsights/workspaces/quoteapi-poc-law","identity":[],"immediate_data_purge_on_30_days_enabled":false,"internet_ingestion_enabled":true,"internet_query_enabled":true,"local_authentication_disabled":true,"local_authentication_enabled":false,"location":"australiasoutheast","name":"quoteapi-poc-law","primary_shared_key":"k+5PC8ugv3yImaj9jB27cRAzaxHbslNCeEyj/kJxlqRuXPXkVVnqOZFLD6lQCD+QyO/xl0+KRTzvshbGenBNXA==","reservation_capacity_in_gb_per_day":null,"resource_group_name":"quoteapi-poc-rg","retention_in_days":30,"secondary_shared_key":"CkGk5ZmjIT+wV8+BngQi2/9++Q5IARKofu22KMD1IMcOKsOiJPHztPW3M2jAX7UgqmDNelCOtZ3fVFan5yQ2CA==","sku":"PerGB2018","tags":{"project":"quoteapi-poc"},"timeouts":null,"workspace_id":"764240cb-e6bb-4fb1-a5fd-ef3aac4af662"},"sensitive_values":{"identity":[],"primary_shared_key":true,"secondary_shared_key":true,"tags":{}},"depends_on":["module.network.azurerm_resource_group.rg"]},{"address":"module.monitoring.azurerm_monitor_action_group.ag","mode":"managed","type":"azurerm_monitor_action_group","name":"ag","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":1,"values":{"arm_role_receiver":[],"automation_runbook_receiver":[],"azure_app_push_receiver":[],"azure_function_receiver":[],"email_receiver":[{"email_address":"binodbhatta@gmail.com","name":"primary","use_common_alert_schema":false}],"enabled":true,"event_hub_receiver":[],"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg/providers/Microsoft.Insights/actionGroups/quoteapi-poc-ag","itsm_receiver":[],"location":"global","logic_app_receiver":[],"name":"quoteapi-poc-ag","resource_group_name":"quoteapi-poc-rg","short_name":"quoteapi-poc","sms_receiver":[],"tags":{},"timeouts":null,"voice_receiver":[],"webhook_receiver":[]},"sensitive_values":{"arm_role_receiver":[],"automation_runbook_receiver":[],"azure_app_push_receiver":[],"azure_function_receiver":[],"email_receiver":[{}],"event_hub_receiver":[],"itsm_receiver":[],"logic_app_receiver":[],"sms_receiver":[],"tags":{},"voice_receiver":[],"webhook_receiver":[]},"depends_on":["module.network.azurerm_resource_group.rg"],"identity_schema_version":0,"identity":{"name":"quoteapi-poc-ag","resource_group_name":"quoteapi-poc-rg","subscription_id":"fa127f23-4720-4538-b725-9219e558d71b"}}],"address":"module.monitoring"},{"resources":[{"address":"module.network.azurerm_resource_group.rg","mode":"managed","type":"azurerm_resource_group","name":"rg","provider_name":"registry.terraform.io/hashicorp/azurerm","schema_version":0,"values":{"id":"/subscriptions/fa127f23-4720-4538-b725-9219e558d71b/resourceGroups/quoteapi-poc-rg","location":"australiasoutheast","managed_by":"","name":"quoteapi-poc-rg","tags":{"env":"quoteapi-poc"},"timeouts":null},"sensitive_values":{"tags":{}}}],"address":"module.network"}]}}},"configuration":{"provider_config":{"azurerm":{"name":"azurerm","full_name":"registry.terraform.io/hashicorp/azurerm","version_constraint":"\u003e= 3.80.0","expressions":{"features":[{}],"subscription_id":{"constant_value":"fa127f23-4720-4538-b725-9219e558d71b"},"tenant_id":{"constant_value":"fb2513c3-cc7e-4238-9f99-6c936f62e2db"}}},"random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","version_constraint":"\u003e= 3.6.0"}},"root_module":{"outputs":{"db_host":{"expression":{"references":["module.data.db_host","module.data"]},"description":"Postgres DB host"},"db_name":{"expression":{"references":["module.data.db_name","module.data"]},"description":"Postgres DB name"},"db_pass":{"sensitive":true,"expression":{"references":["module.data.db_pass","module.data"]},"description":"Postgres DB Password"},"db_user":{"sensitive":true,"expression":{"references":["module.data.db_user","module.data"]},"description":"Postgres DB username"},"quote_url":{"expression":{"references":["module.compute.api_url","module.compute"]},"description":"Base URL for the Quote API"}},"module_calls":{"compute":{"source":"../../modules/compute","expressions":{"action_group_id":{"references":["module.monitoring.action_group_id","module.monitoring"]},"container_image":{"references":["var.container_image"]},"container_port":{"references":["var.container_port"]},"container_tag":{"references":["var.container_tag"]},"instance_count":{"references":["var.instance_count"]},"kv_id":{"references":["module.keyvault.kv_id","module.keyvault"]},"kv_secret_uri":{"references":["module.keyvault.db_conn_secret_uri","module.keyvault"]},"law_id":{"references":["module.monitoring.law_id","module.monitoring"]},"location":{"references":["var.location"]},"project":{"references":["var.project"]},"rg_name":{"references":["module.network.rg_name","module.network"]}},"module":{"outputs":{"api_url":{"expression":{"references":["azurerm_container_app.app.latest_revision_fqdn","azurerm_container_app.app"]}},"container_app_id":{"expression":{"references":["azurerm_container_app.app.id","azurerm_container_app.app"]}},"identity_object_id":{"expression":{"references":["azurerm_container_app.app.identity[0].principal_id","azurerm_container_app.app.identity[0]","azurerm_container_app.app.identity","azurerm_container_app.app"]}}},"resources":[{"address":"azurerm_container_app.app","mode":"managed","type":"azurerm_container_app","name":"app","provider_config_key":"azurerm","expressions":{"container_app_environment_id":{"references":["azurerm_container_app_environment.env.id","azurerm_container_app_environment.env"]},"identity":[{"type":{"constant_value":"SystemAssigned"}}],"ingress":[{"external_enabled":{"constant_value":true},"target_port":{"references":["var.container_port"]},"traffic_weight":[{"latest_revision":{"constant_value":true},"percentage":{"constant_value":100}}],"transport":{"constant_value":"auto"}}],"name":{"references":["local.app_name"]},"resource_group_name":{"references":["var.rg_name"]},"revision_mode":{"constant_value":"Single"},"secret":[{"name":{"constant_value":"db-conn-str"},"value":{"references":["var.kv_secret_uri"]}}],"tags":{"references":["var.project"]},"template":[{"container":[{"cpu":{"constant_value":0.5},"env":[{"name":{"constant_value":"DB_CONNECTION_STRING"},"value":{"constant_value":"secretref:db-conn-str"}}],"image":{"references":["var.container_image","var.container_tag"]},"memory":{"constant_value":"1Gi"},"name":{"constant_value":"quoteapi"}}],"max_replicas":{"references":["var.instance_count"]},"min_replicas":{"references":["var.instance_count"]}}]},"schema_version":0},{"address":"azurerm_container_app_environment.env","mode":"managed","type":"azurerm_container_app_environment","name":"env","provider_config_key":"azurerm","expressions":{"location":{"references":["var.location"]},"name":{"references":["var.project"]},"resource_group_name":{"references":["var.rg_name"]},"tags":{"references":["var.project"]}},"schema_version":0},{"address":"azurerm_key_vault_access_policy.app","mode":"managed","type":"azurerm_key_vault_access_policy","name":"app","provider_config_key":"azurerm","expressions":{"key_vault_id":{"references":["var.kv_id"]},"object_id":{"references":["azurerm_container_app.app.identity[0].principal_id","azurerm_container_app.app.identity[0]","azurerm_container_app.app.identity","azurerm_container_app.app"]},"secret_permissions":{"constant_value":["Get","List"]},"tenant_id":{"references":["data.azurerm_client_config.current.tenant_id","data.azurerm_client_config.current"]}},"schema_version":0},{"address":"azurerm_monitor_diagnostic_setting.app_diag","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"app_diag","provider_config_key":"azurerm","expressions":{"enabled_metric":[{"category":{"constant_value":"AllMetrics"}}],"log_analytics_workspace_id":{"references":["var.law_id"]},"name":{"references":["var.project"]},"target_resource_id":{"references":["azurerm_container_app.app.id","azurerm_container_app.app"]}},"schema_version":0},{"address":"azurerm_monitor_diagnostic_setting.env_logs","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"env_logs","provider_config_key":"azurerm","expressions":{"enabled_log":[{"category":{"constant_value":"ContainerAppConsoleLogs"}},{"category":{"constant_value":"ContainerAppSystemLogs"}}],"log_analytics_workspace_id":{"references":["var.law_id"]},"name":{"references":["var.project"]},"target_resource_id":{"references":["azurerm_container_app_environment.env.id","azurerm_container_app_environment.env"]}},"schema_version":0},{"address":"azurerm_monitor_metric_alert.http5xx_count","mode":"managed","type":"azurerm_monitor_metric_alert","name":"http5xx_count","provider_config_key":"azurerm","expressions":{"action":[{"action_group_id":{"references":["var.action_group_id"]}}],"auto_mitigate":{"constant_value":true},"criteria":[{"aggregation":{"constant_value":"Total"},"dimension":[{"name":{"constant_value":"statusCodeCategory"},"operator":{"constant_value":"Include"},"values":{"constant_value":["5xx"]}}],"metric_name":{"constant_value":"Requests"},"metric_namespace":{"constant_value":"Microsoft.App/containerApps"},"operator":{"constant_value":"GreaterThan"},"threshold":{"constant_value":10}}],"description":{"constant_value":"5xx requests in the last 5m exceed threshold"},"frequency":{"constant_value":"PT1M"},"name":{"constant_value":"quoteapi-poc-5xx-count"},"resource_group_name":{"references":["var.rg_name"]},"scopes":{"references":["azurerm_container_app.app.id","azurerm_container_app.app"]},"severity":{"constant_value":3},"window_size":{"constant_value":"PT5M"}},"schema_version":1},{"address":"data.azurerm_client_config.current","mode":"data","type":"azurerm_client_config","name":"current","provider_config_key":"azurerm","schema_version":0}],"variables":{"action_group_id":{},"container_image":{},"container_port":{},"container_tag":{},"instance_count":{},"kv_id":{},"kv_secret_uri":{},"law_id":{},"location":{},"project":{},"rg_name":{}}},"depends_on":["module.keyvault"]},"data":{"source":"../../modules/data","expressions":{"law_id":{"references":["module.monitoring.law_id","module.monitoring"]},"location":{"references":["var.location"]},"operator_ip":{"references":["var.operator_ip"]},"pg_backup_days":{"references":["var.pg_backup_days"]},"pg_db_name":{"references":["var.pg_db_name"]},"pg_sku_name":{"references":["var.pg_sku_name"]},"pg_storage_mb":{"references":["var.pg_storage_mb"]},"project":{"references":["var.project"]},"rg_name":{"references":["module.network.rg_name","module.network"]}},"module":{"outputs":{"connection_string":{"sensitive":true,"expression":{"references":["local.dsn"]}},"db_host":{"expression":{"references":["local.host"]}},"db_name":{"expression":{"references":["azurerm_postgresql_flexible_server_database.db.name","azurerm_postgresql_flexible_server_database.db"]}},"db_pass":{"expression":{"references":["local.pass"]}},"db_user":{"expression":{"references":["local.user"]}}},"resources":[{"address":"azurerm_monitor_diagnostic_setting.pg_diag","mode":"managed","type":"azurerm_monitor_diagnostic_setting","name":"pg_diag","provider_config_key":"azurerm","expressions":{"enabled_log":[{"category":{"constant_value":"PostgreSQLLogs"}}],"enabled_metric":[{"category":{"constant_value":"AllMetrics"}}],"log_analytics_workspace_id":{"references":["var.law_id"]},"name":{"constant_value":"PostgreSQLDiagnostics"},"target_resource_id":{"references":["azurerm_postgresql_flexible_server.pg.id","azurerm_postgresql_flexible_server.pg"]}},"schema_version":0},{"address":"azurerm_postgresql_flexible_server.pg","mode":"managed","type":"azurerm_postgresql_flexible_server","name":"pg","provider_config_key":"azurerm","expressions":{"administrator_login":{"constant_value":"pgadmin"},"administrator_password":{"references":["random_password.pg.result","random_password.pg"]},"backup_retention_days":{"references":["var.pg_backup_days"]},"location":{"references":["var.location"]},"name":{"references":["var.pg_db_name"]},"public_network_access_enabled":{"constant_value":true},"resource_group_name":{"references":["var.rg_name"]},"sku_name":{"references":["var.pg_sku_name"]},"storage_mb":{"references":["var.pg_storage_mb"]},"tags":{"references":["var.project"]},"version":{"constant_value":"16"}},"schema_version":0},{"address":"azurerm_postgresql_flexible_server_database.db","mode":"managed","type":"azurerm_postgresql_flexible_server_database","name":"db","provider_config_key":"azurerm","expressions":{"charset":{"constant_value":"UTF8"},"collation":{"constant_value":"en_US.utf8"},"name":{"references":["var.pg_db_name"]},"server_id":{"references":["azurerm_postgresql_flexible_server.pg.id","azurerm_postgresql_flexible_server.pg"]}},"schema_version":0},{"address":"azurerm_postgresql_flexible_server_firewall_rule.allowed_ip","mode":"managed","type":"azurerm_postgresql_flexible_server_firewall_rule","name":"allowed_ip","provider_config_key":"azurerm","expressions":{"end_ip_address":{"references":["var.operator_ip"]},"name":{"constant_value":"operator-ip"},"server_id":{"references":["azurerm_postgresql_flexible_server.pg.id","azurerm_postgresql_flexible_server.pg"]},"start_ip_address":{"references":["var.operator_ip"]}},"schema_version":0},{"address":"random_password.pg","mode":"managed","type":"random_password","name":"pg","provider_config_key":"random","expressions":{"length":{"constant_value":20},"special":{"constant_value":true}},"schema_version":3}],"variables":{"law_id":{},"location":{},"operator_ip":{},"pg_backup_days":{},"pg_db_name":{},"pg_sku_name":{},"pg_storage_mb":{},"project":{},"rg_name":{}}},"depends_on":["module.network","module.monitoring"]},"keyvault":{"source":"../../modules/keyvault","expressions":{"db_conn_str":{"references":["module.data.connection_string","module.data"]},"kv_purge_protect":{"references":["var.kv_purge_protect"]},"kv_sku":{"references":["var.kv_sku"]},"location":{"references":["var.location"]},"operator_ip":{"references":["var.operator_ip"]},"project":{"references":["var.project"]},"rg_name":{"references":["module.network.rg_name","module.network"]}},"module":{"outputs":{"db_conn_secret_uri":{"expression":{"references":["azurerm_key_vault_secret.db.id","azurerm_key_vault_secret.db"]}},"kv_id":{"expression":{"references":["azurerm_key_vault.kv.id","azurerm_key_vault.kv"]}}},"resources":[{"address":"azurerm_key_vault.kv","mode":"managed","type":"azurerm_key_vault","name":"kv","provider_config_key":"azurerm","expressions":{"location":{"references":["var.location"]},"name":{"references":["var.project","random_string.kv_suffix.result","random_string.kv_suffix"]},"network_acls":[{"bypass":{"constant_value":"AzureServices"},"default_action":{"constant_value":"Deny"},"ip_rules":{"references":["var.operator_ip"]},"virtual_network_subnet_ids":{"constant_value":[]}}],"public_network_access_enabled":{"constant_value":true},"purge_protection_enabled":{"references":["var.kv_purge_protect"]},"resource_group_name":{"references":["var.rg_name"]},"sku_name":{"references":["var.kv_sku"]},"soft_delete_retention_days":{"constant_value":7},"tags":{"references":["var.project"]},"tenant_id":{"references":["data.azurerm_client_config.current.tenant_id","data.azurerm_client_config.current"]}},"schema_version":2},{"address":"azurerm_key_vault_access_policy.terraform_operator","mode":"managed","type":"azurerm_key_vault_access_policy","name":"terraform_operator","provider_config_key":"azurerm","expressions":{"key_vault_id":{"references":["azurerm_key_vault.kv.id","azurerm_key_vault.kv"]},"object_id":{"references":["data.azurerm_client_config.current.object_id","data.azurerm_client_config.current"]},"secret_permissions":{"constant_value":["Get","List","Set","Delete"]},"tenant_id":{"references":["data.azurerm_client_config.current.tenant_id","data.azurerm_client_config.current"]}},"schema_version":0},{"address":"azurerm_key_vault_secret.db","mode":"managed","type":"azurerm_key_vault_secret","name":"db","provider_config_key":"azurerm","expressions":{"content_type":{"constant_value":"text/plain"},"expiration_date":{},"key_vault_id":{"references":["azurerm_key_vault.kv.id","azurerm_key_vault.kv"]},"name":{"constant_value":"db-connstr"},"value":{"references":["var.db_conn_str"]}},"schema_version":0,"depends_on":["azurerm_key_vault_access_policy.terraform_operator"]},{"address":"random_string.kv_suffix","mode":"managed","type":"random_string","name":"kv_suffix","provider_config_key":"random","expressions":{"length":{"constant_value":4},"special":{"constant_value":false},"upper":{"constant_value":false}},"schema_version":2},{"address":"data.azurerm_client_config.current","mode":"data","type":"azurerm_client_config","name":"current","provider_config_key":"azurerm","schema_version":0}],"variables":{"db_conn_str":{"sensitive":true},"kv_purge_protect":{},"kv_sku":{},"location":{},"operator_ip":{},"project":{},"rg_name":{}}},"depends_on":["module.network","module.data"]},"monitoring":{"source":"../../modules/monitoring","expressions":{"alert_email":{"references":["var.alert_email"]},"location":{"references":["var.location"]},"project":{"references":["var.project"]},"rg_name":{"references":["module.network.rg_name","module.network"]}},"module":{"outputs":{"action_group_id":{"expression":{"references":["azurerm_monitor_action_group.ag.id","azurerm_monitor_action_group.ag"]}},"law_id":{"expression":{"references":["azurerm_log_analytics_workspace.law.id","azurerm_log_analytics_workspace.law"]}}},"resources":[{"address":"azurerm_log_analytics_workspace.law","mode":"managed","type":"azurerm_log_analytics_workspace","name":"law","provider_config_key":"azurerm","expressions":{"location":{"references":["var.location"]},"name":{"references":["var.project"]},"resource_group_name":{"references":["var.rg_name"]},"retention_in_days":{"constant_value":30},"sku":{"constant_value":"PerGB2018"},"tags":{"references":["var.project"]}},"schema_version":3},{"address":"azurerm_monitor_action_group.ag","mode":"managed","type":"azurerm_monitor_action_group","name":"ag","provider_config_key":"azurerm","expressions":{"name":{"references":["var.project"]},"resource_group_name":{"references":["var.rg_name"]},"short_name":{"references":["var.project"]}},"schema_version":1}],"variables":{"alert_email":{},"location":{},"project":{},"rg_name":{}}},"depends_on":["module.network"]},"network":{"source":"../../modules/network","expressions":{"location":{"references":["var.location"]},"project":{"references":["var.project"]}},"module":{"outputs":{"rg_name":{"expression":{"references":["azurerm_resource_group.rg.name","azurerm_resource_group.rg"]}}},"resources":[{"address":"azurerm_resource_group.rg","mode":"managed","type":"azurerm_resource_group","name":"rg","provider_config_key":"azurerm","expressions":{"location":{"references":["var.location"]},"name":{"references":["var.project"]},"tags":{"references":["var.project"]}},"schema_version":0}],"variables":{"location":{},"project":{}}}}},"variables":{"alert_email":{},"container_image":{},"container_port":{},"container_tag":{},"instance_count":{},"kv_purge_protect":{},"kv_sku":{},"location":{},"operator_ip":{},"pg_backup_days":{},"pg_db_name":{},"pg_sku_name":{},"pg_storage_mb":{},"project":{}}}},"relevant_attributes":[{"resource":"module.data.azurerm_postgresql_flexible_server_database.db","attribute":["name"]},{"resource":"module.data.azurerm_postgresql_flexible_server.pg","attribute":["id"]},{"resource":"module.keyvault.data.azurerm_client_config.current","attribute":["object_id"]},{"resource":"module.keyvault.data.azurerm_client_config.current","attribute":["tenant_id"]},{"resource":"module.monitoring.azurerm_monitor_action_group.ag","attribute":["id"]},{"resource":"module.compute.azurerm_container_app.app","attribute":["latest_revision_fqdn"]},{"resource":"module.data.random_password.pg","attribute":["result"]},{"resource":"module.compute.data.azurerm_client_config.current","attribute":["tenant_id"]},{"resource":"module.compute.azurerm_container_app.app","attribute":["id"]},{"resource":"module.monitoring.azurerm_log_analytics_workspace.law","attribute":["id"]},{"resource":"module.compute.azurerm_container_app.app","attribute":["identity",0,"principal_id"]},{"resource":"module.data.azurerm_postgresql_flexible_server.pg","attribute":["fqdn"]},{"resource":"module.keyvault.azurerm_key_vault.kv","attribute":["id"]},{"resource":"module.compute.azurerm_container_app_environment.env","attribute":["id"]},{"resource":"module.keyvault.azurerm_key_vault_secret.db","attribute":["id"]},{"resource":"module.network.azurerm_resource_group.rg","attribute":["name"]},{"resource":"module.data.azurerm_postgresql_flexible_server.pg","attribute":["administrator_login"]},{"resource":"module.data.azurerm_postgresql_flexible_server.pg","attribute":["administrator_password"]},{"resource":"module.keyvault.random_string.kv_suffix","attribute":["result"]}],"timestamp":"2025-09-02T03:47:12Z","applyable":true,"complete":true,"errored":false}
